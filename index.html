<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- Mengatur warna status bar browser Android agar menyatu dengan header -->
    <meta name="theme-color" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Sistem Keuangan Modern</title>
    <!-- Favicon Bertema Uang (Emoji ðŸ’°) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’°</text></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        danger: '#EF4444',
                        warning: '#F59E0B',
                        surface: '#F3F4F6'
                    }
                }
            }
        }
    </script>
    <style>
        /* Mencegah highlight biru saat tap di Android */
        body { 
            -webkit-tap-highlight-color: transparent;
            /* Mencegah pull-to-refresh browser yang mengganggu UX aplikasi */
            overscroll-behavior-y: none;
        }
        
        /* Custom Scrollbar hiding */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4F46E5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        /* Safe Area untuk Gesture Navigation Bar di Android/iPhone terbaru */
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<!-- Menggunakan h-[100dvh] untuk menangani address bar browser mobile yang dinamis -->
<body class="bg-surface text-gray-800 font-sans h-[100dvh] w-full flex flex-col overflow-hidden text-base">

    <!-- Notification Toast -->
    <div id="toast" class="fixed top-5 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-xl z-[60] transition-all duration-300 opacity-0 pointer-events-none flex items-center gap-3 w-max max-w-[90%]">
        <i id="toast-icon" class="fas fa-check-circle text-green-400"></i>
        <span id="toast-message" class="text-sm font-medium truncate">Berhasil disimpan</span>
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center shadow-sm z-10 shrink-0">
        <div>
            <h1 class="text-xl font-bold text-gray-900 tracking-tight">DompetKu</h1>
            <p class="text-xs text-gray-500" id="current-date">Memuat tanggal...</p>
        </div>
        <button onclick="fetchData()" class="p-3 -mr-2 rounded-full hover:bg-gray-100 active:bg-gray-200 transition relative touch-manipulation">
            <i class="fas fa-sync-alt text-gray-600 text-lg" id="refresh-icon"></i>
        </button>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto no-scrollbar relative p-4 pb-32 w-full" id="main-container">
        
        <!-- Summary Cards -->
        <div class="grid grid-cols-1 gap-4 mb-6">
            <!-- Balance -->
            <div class="bg-gradient-to-r from-indigo-600 to-blue-500 rounded-2xl p-5 text-white shadow-lg shadow-indigo-200 relative overflow-hidden">
                <div class="absolute right-0 top-0 opacity-10 transform translate-x-4 -translate-y-4">
                    <i class="fas fa-wallet text-9xl"></i>
                </div>
                <p class="text-indigo-100 text-sm font-medium mb-1 relative z-10">Saldo Saat Ini</p>
                <h2 class="text-4xl font-bold tracking-tight relative z-10" id="total-balance">Rp 0</h2>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <!-- Income -->
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 active:scale-[0.98] transition-transform duration-100">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 shrink-0">
                            <i class="fas fa-arrow-down text-xs"></i>
                        </div>
                        <span class="text-xs text-gray-500 font-medium truncate">Pemasukan</span>
                    </div>
                    <p class="text-lg font-bold text-gray-800 truncate" id="total-income">Rp 0</p>
                </div>
                <!-- Expense -->
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 active:scale-[0.98] transition-transform duration-100">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-600 shrink-0">
                            <i class="fas fa-arrow-up text-xs"></i>
                        </div>
                        <span class="text-xs text-gray-500 font-medium truncate">Pengeluaran</span>
                    </div>
                    <p class="text-lg font-bold text-gray-800 truncate" id="total-expense">Rp 0</p>
                </div>
            </div>
        </div>

        <!-- Filter Month -->
        <div class="flex justify-between items-center mb-4 sticky top-0 bg-surface/95 backdrop-blur py-2 z-10">
            <h3 class="text-lg font-bold text-gray-800">Riwayat</h3>
            <div class="relative">
                <select id="month-filter" onchange="renderHistory()" class="appearance-none bg-white border border-gray-200 text-gray-700 text-sm rounded-full pl-4 pr-8 py-2 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                    <!-- Populated by JS -->
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                    <i class="fas fa-chevron-down text-xs"></i>
                </div>
            </div>
        </div>

        <!-- Transaction List -->
        <div id="transaction-list" class="space-y-3 pb-safe">
            <!-- Items injected here -->
            <div class="text-center py-10 text-gray-400">
                <i class="fas fa-circle-notch fa-spin text-2xl mb-2"></i>
                <p class="text-sm">Mengambil data...</p>
            </div>
        </div>

    </main>

    <!-- Floating Action Button (FAB) -->
    <!-- Menggunakan bottom-24 + pb-safe agar tidak tertutup nav bar -->
    <button onclick="openModal()" class="fixed bottom-[calc(5rem+env(safe-area-inset-bottom,20px))] right-5 bg-gray-900 text-white w-14 h-14 rounded-full shadow-2xl shadow-gray-900/40 flex items-center justify-center text-2xl active:scale-90 transition-transform duration-200 z-30 touch-manipulation">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Bottom Navigation -->
    <nav class="glass border-t border-gray-200 fixed bottom-0 w-full z-40 pb-safe">
        <div class="flex justify-around items-center h-16">
            <button onclick="switchTab('home')" class="nav-btn active flex-1 flex flex-col items-center justify-center h-full gap-1 text-primary transition active:bg-gray-50" data-target="home">
                <i class="fas fa-home text-xl"></i>
                <span class="text-[10px] font-medium">Beranda</span>
            </button>
            <button onclick="switchTab('hutang')" class="nav-btn flex-1 flex flex-col items-center justify-center h-full gap-1 text-gray-400 hover:text-gray-600 transition active:bg-gray-50" data-target="hutang">
                <i class="fas fa-hand-holding-usd text-xl"></i>
                <span class="text-[10px] font-medium">Hutang</span>
            </button>
            <button onclick="switchTab('laporan')" class="nav-btn flex-1 flex flex-col items-center justify-center h-full gap-1 text-gray-400 hover:text-gray-600 transition active:bg-gray-50" data-target="laporan">
                <i class="fas fa-chart-pie text-xl"></i>
                <span class="text-[10px] font-medium">Laporan</span>
            </button>
        </div>
    </nav>

    <!-- Input Modal -->
    <div id="modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden opacity-0 transition-opacity duration-300 flex items-end sm:items-center justify-center">
        <!-- Menggunakan max-h-[90dvh] agar modal tidak terlalu tinggi di landscape/keyboard terbuka -->
        <div class="bg-white w-full sm:max-w-md rounded-t-3xl sm:rounded-2xl p-6 transform transition-transform duration-300 translate-y-full sm:translate-y-0 shadow-2xl flex flex-col max-h-[90dvh]" id="modal-content">
            
            <!-- Handle bar for mobile visual cue -->
            <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-4 sm:hidden"></div>

            <div class="flex justify-between items-center mb-6 shrink-0">
                <h3 class="text-xl font-bold text-gray-900">Tambah Transaksi</h3>
                <button onclick="closeModal()" class="p-2 -mr-2 text-gray-400 hover:text-gray-600 active:text-gray-900">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <form id="transaction-form" onsubmit="submitForm(event)" class="overflow-y-auto no-scrollbar pb-safe">
                <div class="space-y-5">
                    <!-- Tipe Transaksi -->
                    <div class="grid grid-cols-4 gap-2 bg-gray-100 p-1.5 rounded-xl">
                        <label class="cursor-pointer touch-manipulation">
                            <input type="radio" name="tipe" value="Masuk" class="peer hidden" checked>
                            <div class="peer-checked:bg-white peer-checked:text-green-600 peer-checked:shadow-sm py-2.5 text-center rounded-lg text-xs font-bold text-gray-500 transition-all">Masuk</div>
                        </label>
                        <label class="cursor-pointer touch-manipulation">
                            <input type="radio" name="tipe" value="Keluar" class="peer hidden">
                            <div class="peer-checked:bg-white peer-checked:text-red-600 peer-checked:shadow-sm py-2.5 text-center rounded-lg text-xs font-bold text-gray-500 transition-all">Keluar</div>
                        </label>
                        <label class="cursor-pointer touch-manipulation">
                            <input type="radio" name="tipe" value="Hutang" class="peer hidden">
                            <div class="peer-checked:bg-white peer-checked:text-orange-600 peer-checked:shadow-sm py-2.5 text-center rounded-lg text-xs font-bold text-gray-500 transition-all">Hutang</div>
                        </label>
                        <label class="cursor-pointer touch-manipulation">
                            <input type="radio" name="tipe" value="Lainnya" class="peer hidden">
                            <div class="peer-checked:bg-white peer-checked:text-blue-600 peer-checked:shadow-sm py-2.5 text-center rounded-lg text-xs font-bold text-gray-500 transition-all">Lainnya</div>
                        </label>
                    </div>

                    <!-- Jumlah -->
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Jumlah (Rp)</label>
                        <!-- Menggunakan input mode numeric agar keyboard angka muncul di Android -->
                        <input type="tel" inputmode="numeric" name="jumlah" required class="w-full text-3xl font-bold text-gray-900 border-b-2 border-gray-200 focus:border-indigo-600 outline-none py-2 placeholder-gray-300 transition bg-transparent" placeholder="0">
                    </div>

                    <!-- Tanggal & Keterangan -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Tanggal</label>
                            <input type="date" name="tanggal" required class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-base outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition">
                        </div>

                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Keterangan</label>
                            <input type="text" name="keterangan" required class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-base outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition" placeholder="Contoh: Makan Siang">
                        </div>
                    </div>
                </div>

                <button type="submit" id="submit-btn" class="w-full bg-gray-900 hover:bg-black text-white font-bold py-4 rounded-xl mt-8 shadow-lg transition transform active:scale-[0.98] flex justify-center items-center gap-2 touch-manipulation mb-2">
                    <span>Simpan Transaksi</span>
                    <div id="btn-loader" class="loader border-t-white border-gray-500 hidden" style="width: 18px; height: 18px; border-width: 2px;"></div>
                </button>
            </form>
        </div>
    </div>

    <script>
        // ================= CONFIGURATION =================
        // GANTI URL INI DENGAN URL DEPLOYMENT APPS SCRIPT ANDA
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwuNMfGNSn-73ZUiCcGl1v8lRTSZFkYeBvUTQjfMlLzhIfKzLql1cqKv1mW8NmCmZ0/exec"; 
        // =================================================

        let rawData = [];
        let currentMonthFilter = '';

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.querySelector('input[name="tanggal"]').value = today;
            
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = new Date().toLocaleDateString('id-ID', options);
            
            fetchData();
        });

        // --- Core Functions ---
        
        async function fetchData() {
            const icon = document.getElementById('refresh-icon');
            icon.classList.add('fa-spin');
            
            try {
                const response = await fetch(`${WEB_APP_URL}?action=read`);
                const result = await response.json();
                
                if (result.status === 'success') {
                    rawData = result.data;
                    populateMonthFilter();
                    renderHistory(); // Will also update summary
                } else {
                    showToast('Gagal memuat data', 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Koneksi error', 'error');
            } finally {
                icon.classList.remove('fa-spin');
            }
        }

        async function submitForm(e) {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            const loader = document.getElementById('btn-loader');
            const btnText = btn.querySelector('span');

            // UI Loading
            btn.disabled = true;
            btnText.textContent = 'Menyimpan...';
            loader.classList.remove('hidden');

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            // Auto Status for Hutang
            if(data.tipe === 'Hutang') {
                data.status = 'Belum Lunas';
            } else {
                data.status = '-';
            }

            try {
                // Apps Script requires text/plain for POST to avoid CORS preflight issues sometimes
                const response = await fetch(`${WEB_APP_URL}?action=create`, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showToast('Data berhasil disimpan', 'success');
                    closeModal();
                    e.target.reset();
                    // Reset date to today
                    document.querySelector('input[name="tanggal"]').value = new Date().toISOString().split('T')[0];
                    fetchData(); // Refresh data
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                showToast('Gagal menyimpan: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btnText.textContent = 'Simpan Transaksi';
                loader.classList.add('hidden');
            }
        }

        async function markAsPaid(id) {
            if(!confirm("Tandai hutang ini sebagai Lunas?")) return;

            // Show optimistic update immediately or loading? Let's do simple loading
            const card = document.getElementById(`card-${id}`);
            if(card) card.style.opacity = '0.5';

            try {
                const response = await fetch(`${WEB_APP_URL}?action=updateStatus`, {
                    method: 'POST',
                    body: JSON.stringify({ id: id, status: 'Lunas' })
                });
                const result = await response.json();
                
                if (result.status === 'success') {
                    showToast('Hutang Lunas!', 'success');
                    fetchData();
                }
            } catch (error) {
                showToast('Gagal update', 'error');
                if(card) card.style.opacity = '1';
            }
        }

        // --- Rendering Logic ---

        function populateMonthFilter() {
            const select = document.getElementById('month-filter');
            const uniqueMonths = [...new Set(rawData.map(item => {
                const d = new Date(item.tanggal);
                return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
            }))].sort().reverse();

            // Store current selection or default to latest
            const currentVal = select.value || (uniqueMonths.length > 0 ? uniqueMonths[0] : '');
            
            select.innerHTML = uniqueMonths.map(m => {
                const [y, monthNum] = m.split('-');
                const monthName = new Date(y, monthNum - 1).toLocaleString('id-ID', { month: 'long' });
                return `<option value="${m}">${monthName} ${y}</option>`;
            }).join('');
            
            if (uniqueMonths.length === 0) {
                 select.innerHTML = `<option value="">Bulan Ini</option>`;
            } else {
                select.value = currentVal;
            }
        }

        function renderHistory() {
            const filterValue = document.getElementById('month-filter').value;
            const container = document.getElementById('transaction-list');
            
            // Filter Data
            let filteredData = rawData;
            if (filterValue) {
                filteredData = rawData.filter(item => item.tanggal.startsWith(filterValue));
            }

            // Calculate Summary based on filtered data
            let income = 0;
            let expense = 0;
            
            filteredData.forEach(item => {
                const val = parseInt(item.jumlah);
                if (item.tipe === 'Masuk' || item.tipe === 'Lainnya') income += val;
                if (item.tipe === 'Keluar' || item.tipe === 'Hutang') expense += val;
            });

            document.getElementById('total-income').textContent = formatRupiah(income);
            document.getElementById('total-expense').textContent = formatRupiah(expense);
            document.getElementById('total-balance').textContent = formatRupiah(income - expense);

            // Check Active Tab
            const activeTab = document.querySelector('.nav-btn.active').dataset.target;

            if (activeTab === 'hutang') {
                renderDebtList(rawData); // Show all debts regardless of month, or filter? Usually debt is global.
                return;
            } else if (activeTab === 'laporan') {
                container.innerHTML = `<div class="text-center py-10 text-gray-400">Fitur Laporan Grafik akan segera hadir</div>`;
                return;
            }

            // Render List
            if (filteredData.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10 text-gray-400">
                        <i class="fas fa-receipt text-4xl mb-3 opacity-20"></i>
                        <p class="text-sm">Belum ada transaksi bulan ini.</p>
                    </div>`;
                return;
            }

            container.innerHTML = filteredData.map(item => {
                const isExpense = item.tipe === 'Keluar' || item.tipe === 'Hutang';
                const colorClass = isExpense ? 'text-red-600' : 'text-green-600';
                const iconBg = isExpense ? 'bg-red-50' : 'bg-green-50';
                const icon = getIcon(item.tipe);
                const dateDisplay = new Date(item.tanggal).toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });

                return `
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between active:bg-gray-50 transition-colors">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full ${iconBg} flex items-center justify-center ${colorClass} shrink-0">
                            <i class="${icon}"></i>
                        </div>
                        <div class="min-w-0">
                            <p class="font-bold text-gray-800 text-sm truncate">${item.keterangan}</p>
                            <p class="text-xs text-gray-400">${dateDisplay} â€¢ ${item.tipe}</p>
                        </div>
                    </div>
                    <div class="text-right shrink-0 ml-2">
                        <p class="font-bold ${colorClass} text-sm">${isExpense ? '-' : '+'} ${formatRupiah(item.jumlah)}</p>
                    </div>
                </div>
                `;
            }).join('');
        }

        function renderDebtList(data) {
            const container = document.getElementById('transaction-list');
            const debts = data.filter(item => item.tipe === 'Hutang');

            if (debts.length === 0) {
                container.innerHTML = `<div class="text-center py-10 text-gray-400">Tidak ada data hutang.</div>`;
                return;
            }

            container.innerHTML = debts.map(item => {
                const isLunas = item.status === 'Lunas';
                return `
                <div id="card-${item.id}" class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-3 relative overflow-hidden active:bg-gray-50 transition-colors">
                    ${isLunas ? '<div class="absolute top-0 right-0 bg-green-500 text-white text-[10px] px-2 py-1 rounded-bl-lg">LUNAS</div>' : ''}
                    <div class="flex justify-between items-start mb-2">
                        <div class="min-w-0 pr-2">
                            <h4 class="font-bold text-gray-800 truncate">${item.keterangan}</h4>
                            <p class="text-xs text-gray-500">${new Date(item.tanggal).toLocaleDateString('id-ID')}</p>
                        </div>
                        <p class="font-bold text-red-600 shrink-0">${formatRupiah(item.jumlah)}</p>
                    </div>
                    <div class="flex justify-between items-center mt-3 pt-3 border-t border-gray-50">
                        <span class="text-xs font-medium px-2 py-1 rounded ${isLunas ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                            ${item.status}
                        </span>
                        ${!isLunas ? `
                        <button onclick="markAsPaid('${item.id}')" class="text-xs bg-indigo-600 text-white px-3 py-2 rounded-lg hover:bg-indigo-700 active:scale-95 transition shadow-md shadow-indigo-200">
                            Lunasi
                        </button>` : ''}
                    </div>
                </div>
                `;
            }).join('');
        }

        // --- Helpers ---

        function formatRupiah(angka) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(angka);
        }

        function getIcon(tipe) {
            switch(tipe) {
                case 'Masuk': return 'fas fa-wallet';
                case 'Keluar': return 'fas fa-shopping-bag';
                case 'Hutang': return 'fas fa-file-invoice-dollar';
                default: return 'fas fa-coins';
            }
        }

        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const text = document.getElementById('toast-message');

            toast.classList.remove('opacity-0', 'pointer-events-none');
            text.innerText = msg;

            if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle text-red-400';
            } else {
                icon.className = 'fas fa-check-circle text-green-400';
            }

            setTimeout(() => {
                toast.classList.add('opacity-0', 'pointer-events-none');
            }, 3000);
        }

        // --- UI Interactions ---

        function openModal() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            // Small delay for animation
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                content.classList.remove('translate-y-full');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modal-content');
            
            modal.classList.add('opacity-0');
            content.classList.add('translate-y-full'); // Slide down
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function switchTab(target) {
            // Update UI
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.dataset.target === target) {
                    btn.classList.add('active', 'text-primary');
                    btn.classList.remove('text-gray-400');
                    btn.querySelector('i').classList.add('text-primary');
                    btn.querySelector('i').classList.remove('text-gray-400');
                } else {
                    btn.classList.remove('active', 'text-primary');
                    btn.classList.add('text-gray-400');
                    btn.querySelector('i').classList.remove('text-primary');
                    btn.querySelector('i').classList.add('text-gray-400');
                }
            });

            // Re-render based on new active tab
            renderHistory();
        }

        // Close modal on click outside
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });

    </script>
</body>
</html>
